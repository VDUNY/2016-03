@model dynamic

@{
    ViewBag.Title = "SignalR Chat Sample";
}

<div class="row">
    <div class="form-group scrollable" id="output">
        <dl class="dl-horizontal"></dl>
    </div>
</div>

<div class="row">
    <form role="form" class="form-inline" id="input">
        <input type="hidden" id="displayname" />
        <div class="form-group">
            <input type="text" id="message" class="form-control " autocomplete="off" size="80"/>
        </div>
        <button type="submit" class="btn btn-primary">Send</button>
    </form>
</div>

@section scripts {

    <!--Reference the SignalR library. -->
    <script src="~/Scripts/jquery.signalR-2.2.0.min.js"></script>
    <!--Reference the autogenerated SignalR hub script. -->
    <script src="~/signalr/hubs"></script>

    <script type="text/javascript">
        var ws;
        function timestamp(name) {
            return (new Date).toTimeString().split(" ")[0] + " " + name;
        }

        $(function () {
            // Reference the auto-generated proxy for the hub.
            var chat = $.connection.chatHub;

            // A function to display messages
            chat.client.addMessage = function (name, message) {
                // Add the message to the page.
                $("#output dl").append(  $("<dt>").text(timestamp(name)),
                                         $("<dd>").text(message))
                               .parent()
                               .animate( { scrollTop: $('#output dl').height() },
                                         { duration: 500, queue: false });
            };

            // Get the user name and store it to prepend to messages.
            $('#displayname').val(prompt('Enter your name:', ''));

            // Set initial focus to message input box.
            $('#message').focus();

            // Ensures the connection is established before the send handler executes
            $.connection.hub.start().done(function () {

                chat.server.send("Server", $('#displayname').val() + " joined.");

                $("form#input").on("submit", function (event) {
                    chat.server.send($('#displayname').val(), $('#message').val());
                    $("#message").val('').focus();
                    event.preventDefault();
                });

            });
        });
    </script>
}